package faep.controller;

import org.eclipse.core.runtime.preferences.ConfigurationScope;
import org.eclipse.core.runtime.preferences.IEclipsePreferences;
import org.eclipse.swt.SWT;

import faep.controller.listeners.FaepPreferenceListener;
import faep.controller.listeners.FaepSearchSelectionListener;
import faep.gui.views.FaepView;

public class FaepController {

    private static FaepController controller;
    private FaepView view;
    private IEclipsePreferences preferences;
    private FaepSearchSelectionListener searchListener;

    private FaepController() {
    }

    public static FaepController getInstance() {
	if (controller == null) {
	    controller = new FaepController();
	}
	return controller;
    }

    /**
     * Sets this class as the controller for FaepView
     * 
     * @param view
     * 		Instance of the Freelancer view.
     */
    public void setView(FaepView view) {
	this.view = view;
	if (searchListener == null) {
	    searchListener = new FaepSearchSelectionListener();
	}
	if (view.getSearchButton() != null && view.getSearchCombo() != null
		&& view.getSearchButton().getListeners(SWT.Selection).length == 0) {
	    view.getSearchButton().addSelectionListener(searchListener);
	    view.getSearchCombo().addSelectionListener(searchListener);
	}
    }

    public FaepView getView() {
	return view;
    }

    public void addPreferenceChangeListener() {
	preferences = ConfigurationScope.INSTANCE.getNode("faep.plugin.preferences");
	FaepPreferenceListener listener = new FaepPreferenceListener();
	preferences.addPreferenceChangeListener(listener);
    }
}
